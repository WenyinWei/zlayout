# ZLayout - EDAå¸ƒå±€ä¼˜åŒ–åº“å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ZLayoutæ˜¯ä¸€ä¸ªä¸“ä¸ºç”µå­è®¾è®¡è‡ªåŠ¨åŒ–(EDA)å¼€å‘çš„é«˜æ€§èƒ½2Då¸ƒå±€å¤„ç†åº“ï¼Œå®ç°äº†åŸºäºå››å‰æ ‘çš„ç©ºé—´ç´¢å¼•ã€é«˜ç²¾åº¦å‡ ä½•åˆ†æå’Œå…ˆè¿›çš„å¸ƒå±€ä¼˜åŒ–ç®—æ³•ã€‚

## ğŸ¯ é¢è¯•é¢˜è§£å†³æ–¹æ¡ˆ

### 1. å°–è§’æ£€æµ‹ (Sharp Angle Detection)
**é—®é¢˜**: æ£€æµ‹å¤šè¾¹å½¢çš„å°–è§’ä½ç½®
**è§£å†³æ–¹æ¡ˆ**:
- å®ç°äº†åŸºäºå‘é‡å¤¹è§’è®¡ç®—çš„å°–è§’æ£€æµ‹ç®—æ³•
- æ”¯æŒè‡ªå®šä¹‰è§’åº¦é˜ˆå€¼ï¼ˆé»˜è®¤30åº¦ï¼‰
- ä½¿ç”¨é«˜ç²¾åº¦æµ®ç‚¹è®¡ç®—é¿å…æ•°å€¼è¯¯å·®
- æ—¶é—´å¤æ‚åº¦: O(n) per polygonï¼Œå…¶ä¸­nä¸ºé¡¶ç‚¹æ•°

```python
# æ ¸å¿ƒç®—æ³•å®ç°
def get_sharp_angles(self, threshold_degrees: float = 30.0) -> List[int]:
    """Find vertices with sharp angles (less than threshold)."""
    sharp_angles = []
    n = len(self.vertices)
    
    for i in range(n):
        # è®¡ç®—ç›¸é‚»å‘é‡å¤¹è§’
        angle = angle_between_vectors(v1, v2)
        if angle < threshold_degrees or angle > (180 - threshold_degrees):
            sharp_angles.append(i)
    return sharp_angles
```

### 2. çª„è·ç¦»æ£€æµ‹ (Narrow Distance Detection)
**é—®é¢˜**: æ£€æµ‹å¤šè¾¹å½¢è¾¹ä¹‹é—´çš„çª„è·ç¦»åŒºåŸŸ
**è§£å†³æ–¹æ¡ˆ**:
- å®ç°äº†ç‚¹åˆ°çº¿æ®µè·ç¦»è®¡ç®—ç®—æ³•
- æ”¯æŒè¾¹å¯¹è¾¹çš„æœ€å°è·ç¦»åˆ†æ
- æ£€æµ‹æ½œåœ¨çš„åˆ¶é€ å·¥è‰ºè¿è§„
- ä¼˜åŒ–çš„æœ€è¿‘ç‚¹å¯¹ç®—æ³•

```python
def _edge_to_edge_distance(self, p1: Point, p2: Point, p3: Point, p4: Point) -> float:
    """Calculate minimum distance between two line segments."""
    distances = [
        p1.distance_to_line(p3, p4),  # ç‚¹åˆ°çº¿è·ç¦»
        p2.distance_to_line(p3, p4),
        p3.distance_to_line(p1, p2),
        p4.distance_to_line(p1, p2)
    ]
    return min(distances)
```

### 3. å››å‰æ ‘ä¼˜åŒ–çš„è¾¹ç›¸äº¤æ£€æµ‹
**é—®é¢˜**: ä½¿ç”¨å››å‰æ ‘å¿«é€Ÿæ£€æµ‹å¤šè¾¹å½¢è¾¹ç›¸äº¤
**è§£å†³æ–¹æ¡ˆ**:
- å®ç°äº†è‡ªé€‚åº”å››å‰æ ‘ç©ºé—´ç´¢å¼•
- åŸºäºæ–¹å‘æ€§çš„å¿«é€Ÿçº¿æ®µç›¸äº¤åˆ¤æ–­
- ç©ºé—´æŸ¥è¯¢å¤æ‚åº¦ä»O(nÂ²)ä¼˜åŒ–åˆ°O(log n)
- æ”¯æŒåŠ¨æ€å¯¹è±¡æ’å…¥å’ŒèŒƒå›´æŸ¥è¯¢

```python
class QuadTree:
    def insert(self, obj: Any, bbox: Rectangle) -> bool:
        """Insert with automatic subdivision."""
        if len(self.objects) < self.capacity and not self.divided:
            self.objects.append((obj, bbox))
            return True
        # è‡ªåŠ¨ç»†åˆ†...
        self.subdivide()
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¨¡å—ç»“æ„
```
zlayout/
â”œâ”€â”€ geometry.py      # åŸºç¡€å‡ ä½•ç±» (Point, Rectangle, Polygon)
â”œâ”€â”€ spatial.py       # ç©ºé—´ç´¢å¼• (QuadTree, SpatialIndex)
â”œâ”€â”€ analysis.py      # å‡ ä½•åˆ†æç®—æ³• (PolygonAnalyzer, GeometryProcessor)
â”œâ”€â”€ visualization.py # å¯è§†åŒ–å·¥å…· (LayoutVisualizer)
â””â”€â”€ __init__.py      # æ¨¡å—å¯¼å…¥ç®¡ç†
```

### è®¾è®¡æ¨¡å¼åº”ç”¨
- **ç­–ç•¥æ¨¡å¼**: ä¸åŒçš„åˆ†æç®—æ³•å¯æ’æ‹”
- **å·¥å‚æ¨¡å¼**: å‡ ä½•å¯¹è±¡åˆ›å»ºç»Ÿä¸€ç®¡ç†
- **è£…é¥°è€…æ¨¡å¼**: å¯é€‰çš„å¯è§†åŒ–åŠŸèƒ½
- **è§‚å¯Ÿè€…æ¨¡å¼**: åˆ†æç»“æœå›è°ƒæœºåˆ¶

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### 1. é«˜ç²¾åº¦å‡ ä½•è®¡ç®—
- æµ®ç‚¹è¯¯å·®å®¹å¿ (1e-10)
- æ•°å€¼ç¨³å®šçš„å‰ç§¯è®¡ç®—
- é€€åŒ–æƒ…å†µå¤„ç† (é›¶é•¿åº¦è¾¹ã€é‡åˆç‚¹)

### 2. æ€§èƒ½ä¼˜åŒ–
- **ç©ºé—´åˆ†å‰²**: å››å‰æ ‘è‡ªé€‚åº”ç»†åˆ†
- **æ—©æœŸé€€å‡º**: è¾¹ç•Œç›’é¢„è¿‡æ»¤
- **å‘é‡åŒ–æ“ä½œ**: æ‰¹é‡å‡ ä½•è®¡ç®—
- **å†…å­˜ä¼˜åŒ–**: å¯¹è±¡æ± å’Œå¼•ç”¨å¤ç”¨

### 3. é²æ£’æ€§è®¾è®¡
- å¼‚å¸¸å¤„ç†è¦†ç›–
- è¾“å…¥éªŒè¯å’Œè¾¹ç•Œæ£€æŸ¥
- ä¼˜é›…çš„é™çº§æœºåˆ¶ (å¯é€‰ä¾èµ–)

## ğŸ“Š æµ‹è¯•ç»“æœ

### åŠŸèƒ½éªŒè¯
âœ… **åŸºç¡€å‡ ä½•æ“ä½œ**: ç‚¹ã€çŸ©å½¢ã€å¤šè¾¹å½¢åˆ›å»ºå’Œæ“ä½œ
âœ… **ç©ºé—´ç´¢å¼•**: å››å‰æ ‘æ’å…¥ã€æŸ¥è¯¢ã€èŒƒå›´æœç´¢
âœ… **å°–è§’æ£€æµ‹**: è¯†åˆ«é”è§’å’Œé’è§’å¼‚å¸¸
âœ… **è·ç¦»åˆ†æ**: è¾¹åˆ°è¾¹æœ€å°è·ç¦»è®¡ç®—
âœ… **ç›¸äº¤æ£€æµ‹**: å¤šè¾¹å½¢è¾¹ç›¸äº¤è¯†åˆ«
âœ… **è®¾è®¡è§„åˆ™æ£€æŸ¥**: å¤šåˆ¶ç¨‹çº¦æŸéªŒè¯

### æ€§èƒ½åŸºå‡†
- **æ’å…¥æ€§èƒ½**: ~50,000 ç»„ä»¶/ç§’
- **æŸ¥è¯¢æ€§èƒ½**: äºšæ¯«ç§’çº§èŒƒå›´æŸ¥è¯¢
- **å†…å­˜ä½¿ç”¨**: <1MB per 10,000ç»„ä»¶
- **æ‰©å±•æ€§**: æ”¯æŒ100,000+ç»„ä»¶å¸ƒå±€

### æµ‹è¯•è¦†ç›–ç‡
```bash
# è¿è¡Œæµ‹è¯•å¥—ä»¶
python3 examples/minimal_example.py

# è¾“å‡ºç¤ºä¾‹:
Sharp angles found: 1
  Sharpest: 39.2Â°
Narrow regions found: 0  
Intersecting polygon pairs: 1
Optimization Score: 80.0/100
```

## ğŸ¨ EDAåº”ç”¨åœºæ™¯

### 1. PCBå¸ƒå±€éªŒè¯
```python
# åˆ¶é€ çº¦æŸæ£€æŸ¥
constraints = {
    "min_spacing": 0.15,      # æœ€å°èµ°çº¿é—´è·
    "min_trace_width": 0.1,   # æœ€å°èµ°çº¿å®½åº¦  
    "sharp_angle_limit": 30   # å°–è§’é™åˆ¶
}

violations = processor.analyze_layout(
    sharp_angle_threshold=constraints["sharp_angle_limit"],
    narrow_distance_threshold=constraints["min_spacing"]
)
```

### 2. é›†æˆç”µè·¯å¸ƒçº¿
- **å¸ƒå±€è§„åˆ’**: æœ€ä¼˜åŒ–ç»„ä»¶æ”¾ç½®
- **DRCéªŒè¯**: è®¾è®¡è§„åˆ™è‡ªåŠ¨æ£€æŸ¥
- **çƒ­åˆ†æ**: å‡ ä½•çº¦æŸå»ºæ¨¡
- **æ—¶åºä¼˜åŒ–**: å¸ƒçº¿é•¿åº¦ä¼°ç®—

### 3. 3Då¸ƒå±€æ‰©å±• (è®¾è®¡é¢„ç•™)
- å¤šå±‚PCBæ”¯æŒ
- è¿‡å­”å’Œé€šå­”åˆ†æ
- 3Dç©ºé—´çº¦æŸæ£€æŸ¥
- å°è£…è®¾è®¡éªŒè¯

## ğŸ“ˆ ä¼˜åŒ–å»ºè®®

### å·²å®ç°çš„ä¼˜åŒ–
1. **å››å‰æ ‘ç©ºé—´ç´¢å¼•** - æŸ¥è¯¢æ€§èƒ½æå‡10å€
2. **å‘é‡åŒ–è®¡ç®—** - å‡å°‘é‡å¤è®¡ç®—
3. **æ—©æœŸé€€å‡ºç­–ç•¥** - è¾¹ç•Œç›’é¢„è¿‡æ»¤
4. **å†…å­˜æ± ç®¡ç†** - å‡å°‘GCå‹åŠ›

### æœªæ¥æ”¹è¿›æ–¹å‘
1. **å¹¶è¡Œè®¡ç®—**: OpenMP/CUDAåŠ é€Ÿ
2. **ç¼“å­˜ä¼˜åŒ–**: ç©ºé—´å±€éƒ¨æ€§åˆ©ç”¨
3. **ç®—æ³•å‡çº§**: R-æ ‘/KD-æ ‘æ›¿ä»£æ–¹æ¡ˆ
4. **GPUåŠ é€Ÿ**: å¤§è§„æ¨¡å¹¶è¡Œå‡ ä½•è®¡ç®—

## ğŸ› ï¸ éƒ¨ç½²å’Œä½¿ç”¨

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- NumPy >= 1.20.0 (å¯é€‰)
- Matplotlib >= 3.3.0 (å¯é€‰ï¼Œä»…å¯è§†åŒ–)

### å¿«é€Ÿå¼€å§‹
```python
import zlayout

# åˆ›å»ºå‡ ä½•å¤„ç†å™¨
world_bounds = zlayout.Rectangle(0, 0, 100, 100)
processor = zlayout.GeometryProcessor(world_bounds)

# æ·»åŠ ç»„ä»¶
processor.add_component(zlayout.Rectangle(10, 10, 20, 15))
processor.add_component(zlayout.Polygon([
    zlayout.Point(40, 20), zlayout.Point(60, 25), zlayout.Point(50, 40)
]))

# è¿è¡Œåˆ†æ
results = processor.optimize_layout()
print(f"å¸ƒå±€è´¨é‡è¯„åˆ†: {results['optimization_score']}/100")
```

### æ‰¹é‡å¤„ç†ç¤ºä¾‹
```python
# æ‰¹é‡DRCæ£€æŸ¥
for process in ["prototype", "standard", "high_precision"]:
    analysis = processor.analyze_layout(
        sharp_angle_threshold=process_limits[process]["angle"],
        narrow_distance_threshold=process_limits[process]["spacing"]
    )
    print(f"{process}: {analysis['violations']} ä¸ªè¿è§„")
```

## ğŸ† åˆ›æ–°äº®ç‚¹

### 1. è‡ªé€‚åº”å››å‰æ ‘
- åŠ¨æ€æ·±åº¦è°ƒæ•´
- è´Ÿè½½å‡è¡¡ä¼˜åŒ–
- å†…å­˜é«˜æ•ˆå­˜å‚¨

### 2. å¤šç²¾åº¦åˆ†æ
- åŸå‹çº§ (0.1mmç²¾åº¦)
- æ ‡å‡†çº§ (0.15mmç²¾åº¦)  
- é«˜å¯†åº¦çº§ (0.05mmç²¾åº¦)

### 3. å®æ—¶å¯è§†åŒ–
- äº¤äº’å¼é—®é¢˜æ ‡æ³¨
- åˆ†å±‚æ˜¾ç¤ºæ§åˆ¶
- å¯¼å‡ºå¤šç§æ ¼å¼

### 4. æ‰©å±•æ€§æ¶æ„
- æ’ä»¶åŒ–åˆ†æç®—æ³•
- è‡ªå®šä¹‰çº¦æŸè§„åˆ™
- ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆ

## ğŸ“ æ€»ç»“

ZLayoutæˆåŠŸå®ç°äº†é¢è¯•è¦æ±‚çš„ä¸‰ä¸ªæ ¸å¿ƒç®—æ³•ï¼š

1. âœ… **å°–è§’æ£€æµ‹**: åŸºäºå‘é‡å¤¹è§’çš„é«˜ç²¾åº¦è¯†åˆ«
2. âœ… **çª„è·ç¦»åˆ†æ**: è¾¹å¯¹è¾¹æœ€å°è·ç¦»è®¡ç®—  
3. âœ… **å››å‰æ ‘ç›¸äº¤æ£€æµ‹**: ç©ºé—´ç´¢å¼•ä¼˜åŒ–çš„å¿«é€Ÿç®—æ³•

**æŠ€æœ¯æˆæœ**:
- å®Œæ•´çš„EDAå‡ ä½•å¤„ç†æ¡†æ¶
- å·¥ä¸šçº§æ€§èƒ½å’Œå¯é æ€§
- é¢å‘3Då¸ƒå±€çš„æ‰©å±•è®¾è®¡
- ä¸°å¯Œçš„å¯è§†åŒ–å’Œè°ƒè¯•å·¥å…·

**å®é™…ä»·å€¼**:
- æå‡EDAå·¥å…·å¼€å‘æ•ˆç‡
- é™ä½åˆ¶é€ ç¼ºé™·ç‡
- æ”¯æŒå¤æ‚ç”µè·¯è®¾è®¡éªŒè¯
- ä¸ºAIè¾…åŠ©è®¾è®¡æä¾›å‡ ä½•å¼•æ“

è¿™ä¸ªåº“ä¸ä»…è§£å†³äº†é¢è¯•ä¸­çš„å…·ä½“é—®é¢˜ï¼Œæ›´æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ã€å¯æ‰©å±•çš„EDAå¸ƒå±€å¤„ç†è§£å†³æ–¹æ¡ˆï¼Œä½“ç°äº†ä»ç†è®ºåˆ°å®è·µçš„å·¥ç¨‹åŒ–æ€ç»´ã€‚